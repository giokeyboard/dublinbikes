<!DOCTYPE html>
<html lang="en-US">
    <head>
        <title>Dublin Bike App</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    </head>
    
    <body>
        <h1 align="center">Dublin Bike App</h1>
        <div id="map" style="width:100%;height:300px;"></div>
        <p id="demo1"></p>
    
        <p id="demo3"></p>
    
        <p id="demo7"></p>
<input id="searchTextField" type="text" size="50" placeholder="Enter starting point" autocomplete="on" runat="server" onclick="initialize()"/> 
<input id="searchTextField2" type="text" size="50" placeholder="Enter ending point" autocomplete="on" runat="server" onclick="initialize2()" />
        <p><b> Real Time Information on station close to your source:      </b></p>
        <p id="demo2"></p>
        <p id="demo4"></p>
        <p><b>Real Time Information on station close to your destination: </b></p>
    
        <p id="demo5"></p>
        <p id="demo6"></p>
    
        <p id="demo8"></p>
        <p id="demo9"></p>
        <p id="demo10"></p>
    
        <p id="demo11"></p>
        <p id="demo12"></p>
        <p id="demo13"></p>
        <p id="demo14"></p>
        <script>
            var myObj={{ data|tojson }};
            var lat=new Array(myObj.length);
            var long=new Array(myObj.length);
    
    //To get the list of latitude of stations
            for(var i=0;i<myObj.length;i++)
            {
              lat[i]=myObj[i][6];
            }
   
     //To get the list of longitude of stations
            for(var i=0;i<myObj.length;i++)
            {
          
                long[i]=myObj[i][7];
            }
        
    
    //To get the list of latitude and longitude of stations as a tuple 
            var latlong=new Array(myObj.length);
            for(var i=0;i<myObj.length;i++)
                {
                    latlong[i]=[lat[i],long[i]];
                }
   
    
    //To fetch the list of station names
            var address_2=new Array(myObj.length);
            for(var i=0;i<myObj.length;i++)
                {
                address_2[i]=myObj[i][0];
                }
            var infowindow;
    
     //To set up the map with desired properties
            function myMap() {
                var myCenter = {lat: 53.349605, lng:-6.264175 };  
                var mapCanvas = document.getElementById("map");
                var mapOptions = {center: myCenter, zoom: 14};
                var map = new google.maps.Map(mapCanvas, mapOptions);
                infowindow = new google.maps.InfoWindow({  
                    maxWidth: 355
                    });    
                for(var j=0;j<latlong.length;j++)
                {
                    var marker=new google.maps.Marker({
                    position:new google.maps.LatLng(latlong[j][0],latlong[j][1]),
                    map:map,
                    addre:address_2[j],
                    latitiude:lat[j],
                    longitude:long[j]
            });
      popupDirections(marker);
    
                }
      
            }
            function popupDirections(marker) {
            
                //This function created listener listens for click on a marker to show information specific to that marker
                google.maps.event.addListener(marker, 'click', function () {
                for (var i = 0; i <address_2.length; i++)
                { infowindow.setContent("Address: " + marker.addre +"<br>"+"Latitude:" + marker.latitiude+"<br>"+"Longitude:"+marker.longitude); } infowindow.open(map, marker); //This opens the infowindow at the marker
                });
            }
            
            //This function finds the closest station corresponding to the chosen source and destination by the user
            
            function getDistanceFromLatLonInKm(latitude,longitude,m) {
                var x= latitude; 
                var y=longitude;
                var closest_location;  
                var min=0;
                var axis=0;
                var value=0;
                var dist_array=new Array(latlong.length);
                for(var i=0;i<latlong.length;i++)
                {
                    axis=((x-latlong[i][0])*(x-latlong[i][0]))+((y-latlong[i][1])*(y-latlong[i][1]))
                    value=Math.sqrt(axis);
                    dist_array[i]=value;
                }
                    var min = Math.min.apply(Math, dist_array);
                    var idx=dist_array.indexOf(Math.min.apply(null,dist_array))
                    var nearest_station=address_2[idx];
                    if(m==0)
                    {
                        document.getElementById("demo4").innerHTML="the minimum distance is "+min; 
                        document.getElementById("demo2").innerHTML="The nearest station to your souce coordinate is "+nearest_station;  
            
                    }
                    else{
        
                        document.getElementById("demo5").innerHTML="the minimum distance is "+min; 
                        document.getElementById("demo6").innerHTML="The nearest station to your destination coordinate is "+nearest_station;  
                    }
                }
    
                //This function is triggered whenver user clicks on "Enter starting point" field to enter the source
                
                function initialize() {
                    var input = document.getElementById('searchTextField');
                    var autocomplete = new google.maps.places.Autocomplete(input);
                    google.maps.event.addListener(autocomplete, 'place_changed', function () {
                        var place = autocomplete.getPlace();
                        var latitude = place.geometry.location.lat();
                        var longitude=place.geometry.location.lng();
                        var m=0;
                        getDistanceFromLatLonInKm(latitude,longitude,m);
                    });
        
                }
                //This function is triggered whenver user clicks on "Enter ending point" field to enter the destination
    
    
                function initialize2() {
                    var input = document.getElementById('searchTextField2');
                    var autocomplete = new google.maps.places.Autocomplete(input);
                    google.maps.event.addListener(autocomplete, 'place_changed', function () {
                        var place = autocomplete.getPlace();
                        var latitude = place.geometry.location.lat();
                        var longitude=place.geometry.location.lng();
                        var m=1;
         
                        getDistanceFromLatLonInKm(latitude,longitude,m);
           
                    });
                }
                
                google.maps.event.addDomListener(window, 'load', initialize); 
        
        </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA3XfuMJJGzaU8TUItQM7XWD4esZdbpgtA&callback=myMap&libraries=places"></script>
    </body>
</html>